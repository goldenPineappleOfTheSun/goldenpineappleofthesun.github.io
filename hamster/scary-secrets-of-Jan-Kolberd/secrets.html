<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		body {
			margin: 0;
			overflow:hidden;
		}
		#data {
			position: fixed;
			width: 100vw;
			height: 100vh;
		}
	</style>
</head>
<body>

	<div id="screen" style="display:none">
	</div>

	<canvas id="canvas" style="position:fixed;width:100%;width:100vw;height:100%;height:100vh;">	
	</canvas>

	<script src="three.min.js"></script>
	<script src="threeScene.js"></script>
	<script src="gm.js"></script>

	<script>
		'use strict'

		// sprites is not used by me actually, but i need them as collision boxes
		let wallSpr = addSprite('defaultWall', 'img/default-wall.png', 64, 64)
		let playerSpr = addSprite('player', 'img/player-walk.png', 48, 48)

		loadTexture('img/player-walk.png');
		loadTexture('img/default-wall.png');

		let playerWalkAnimator = new TextureAnimator( cachedTextures['img/player-walk.png'], 8, 1, 8, 200 );

		let playerEntity = addGameObject('player', playerSpr)
			.on.create(function(){
			})
			.on.beforeStep(function(){
				//this.animationSpeed(0);
			})
			.on.step(function(){
			})
			.on.collision('wall', function(other){
				if (other.x > this.x)
					this.x -= Math.abs(this.x - this.xPrev);
				if (other.x < this.x)
					this.x += Math.abs(this.x - this.xPrev);
				if (other.y > this.y)
					this.y -= Math.abs(this.y - this.yPrev);
				if (other.y < this.y)
					this.y += Math.abs(this.y - this.yPrev);
			})
			.on.keyboard("Left", function(){
				this.animationSpeed(1);
				this.model.base.mesh.scale.x = -1;
				this.x -= 3;
			})
			.on.keyboard('Right', function(){
				this.animationSpeed(1);
				this.model.base.mesh.scale.x = 1;
				this.x += 3;
			})
			.on.keyboard('Up', function(){
				this.animationSpeed(1);
				this.y += 3;
			})
			.on.keyboard('Down', function(){
				this.animationSpeed(1);
				this.y -= 3;
			})
			.on.keyUp('Left', function(){
				this.animationSpeed(0);
			})
			.on.keyUp('Right', function(){
				this.animationSpeed(0);
			})
			.on.keyUp('Up', function(){
				this.animationSpeed(0);
			})
			.on.keyUp('Down', function(){
				this.animationSpeed(0);
			})
			.registrate('die', function(){
			})
			.collider(6, 4, 48, 60)
			.registrateModel(function(){
				return createModel('player', 'img/player-walk.png', 64, 64, {animator: playerWalkAnimator})
					.root(this).done();
			})

		let wallEntity = addGameObject('wall', wallSpr)
			.on.create(function(){
			})
			.on.step(function(){
			})
			.collider(0, 0, 64, 64)
			.isStatic(true)
			.registrateModel(function(){
				return createModel('wall', 'img/default-wall.png', 64, 64, {})
					.root(this).done();
			})

		//let initialized = false;

		//setTimeout(function(){

		window.player = createObject('player', null, 0, 0, 'player')
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		createObject('wall', null, Math.floor((-500 + Math.random() * 1000)/64)*64, Math.floor((-500 + Math.random() * 1000)/64)*64)
		//createObject('controller', null, 0, 0)

		//	initialized = true;
		//}, 100)

		//background.src = 'street-racing-img/bg.png';

		let onstep = function() {
			threeSceneRender()
			camera.position.x += (player.x - camera.position.x) / 10
			camera.position.y += (player.y - camera.position.y) / 10
		}

	</script>
</body>
</html>